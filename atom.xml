<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  
  <title><![CDATA[DevOps:~/erlang darcy$]]></title>
  
  <link href="/atom.xml" rel="self"/>
  <link href="http://yoursite.com//"/>
  <updated>2015-09-05T03:07:38.000Z</updated>
  <id>http://yoursite.com//</id>
  
  <author>
    <name><![CDATA[Darcy Song]]></name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title><![CDATA[reading-notes-ansible-up-and-running]]></title>
    <link href="http://yoursite.com/2015/09/05/reading-notes-ansible-up-and-running/index.html"/>
    <id>http://yoursite.com/2015/09/05/reading-notes-ansible-up-and-running/index.html</id>
    <published>2015-09-05T02:53:04.000Z</published>
    <updated>2015-09-05T03:07:38.000Z</updated>
    <content type="html"><![CDATA[<h2 id="简介">简介</h2><p>大而全的入门书籍，</p>
<h3 id="笔记">笔记</h3><h4 id="ansible的来历">ansible的来历</h4><p>最早来源于一部科幻小说，是一种超光速长距离的通讯设备，后来这个名字在《安德的游戏》中被借用，就是用来操作千军万马对抗外星生物的控制设备，这么看来这个名字还是很贴切的。</p>
<h4 id="第一章">第一章</h4><ul>
<li>YAML is to JSON what Markdown is to HTML.</li>
<li>Ansible是push的，puppet是pull的。不过ansible也支持pull模式的，用ansible-pull，我在14年底前差不多用了2年多的puppet，我都没觉得pull模式有什么好，反而最后都做成了masterless的puppet用法。</li>
<li>金句， Alan Kay’s maxim: “Simple things should be simple, complex things should be possible.”</li>
<li></li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<h2 id="简介">简介</h2><p>大而全的入门书籍，</p>
<h3 id="笔记">笔记</h3><h4 id="ansible的来历">ansible的来历</h4><p>最早来源于一部科幻小说，是一种超光速长距离的通讯设备，后来这个名字在《安德的游戏》中被借用，就]]>
    </summary>
    
      <category term="ansible" scheme="http://yoursite.com/tags/ansible/"/>
    
      <category term="reading-notes" scheme="http://yoursite.com/tags/reading-notes/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[阅读笔记- 《Ansible Playbook Essentials》]]></title>
    <link href="http://yoursite.com/2015/09/04/readbook-ansible-playbook-essentials/index.html"/>
    <id>http://yoursite.com/2015/09/04/readbook-ansible-playbook-essentials/index.html</id>
    <published>2015-09-04T06:16:28.000Z</published>
    <updated>2015-09-04T16:39:42.000Z</updated>
    <content type="html"><![CDATA[<h3 id="简介">简介</h3><p>个人觉得在阅读这本书前，最好读一些基础的ansible书籍，看过一些例子，然后自己写过一些ansible的playbook，对playbook有初步的了解，同时问题也有一些。<br>这本书是着重阐述怎么去设计一个结构良好，功能完善的playbook，内容还是不错的，官方文档或者入门书籍着重介绍ansible的各个功能，但是对如果组织使用这些功能探讨的不会太深。<br>再没看这本书之前，也许你和我一样，写出的playbook的role都只有main.yml文件，这本书是指导我们应该怎么样正确的规划我们的infrastructure，从而然后写出可复用的，模块化的playbook</p>
<h3 id="读后感">读后感</h3><p>这本书从一个简单的例子，最直观的方式完成一个playbook，后续的章节，围绕这个例子做各种各样的重构。所以前后一贯，再看到后面的章节的时会不断的对之前的做法进行反思。 有些pragmatic的风格。<br>此外，例子中的output截图配上注释非常直观，便于理解。<br>最喜欢的是第九章，因为自己刚写了没多久的playbook，也一直考虑多环境的playbook该如何设计，并且dev和prod不会互相影响，又方便merge code，我觉得第二种方案实在太爽了，这里就不书透了，如果有相同问题，可以找来重点看看。</p>
<h3 id="笔记">笔记</h3><ul>
<li>pre-tasks和post-tasks可以用来在执行之前关闭和打开nagios</li>
<li>delegate_to可以用来做从lb摘除web server之类的动作</li>
<li>在playbook里指定serial参数用来限定每次执行的server个数</li>
<li>wait_for用来检查状态很用帮助</li>
<li>将安装和配置分离，用main.yml import install.yml 和 configure.yml, 让task 模块化  </li>
<li>如果要用command/shell等模块，为了保持幂等性，可以使用creates和removes flag<ul>
<li>如果command会创建一个文件，可以用creates flag来测试这个文件，如果已经存在，则不再做</li>
<li>如果command的用途不是创建文件，也需要创建一个flag用来保持幂等性。</li>
</ul>
</li>
<li>变量定义, ansible可以定义变量的地方实在是很多，书中有一节梳理的非常清晰</li>
<li>多级变量需要merge的话，得打开hash_behaviour=merge，参见下面的例子</li>
</ul>
<h4 id="多级变量_merging_hashes">多级变量 merging hashes</h4><p>比如在default里定义了<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis:&#10;   config:&#10;      port: 6379&#10;      url: xxxx.redis.xxxx.com</span><br></pre></td></tr></table></figure><br>在 vars里定义了<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis:&#10;   config:&#10;      port: 4567</span><br></pre></td></tr></table></figure></p>
<p>按照ansible default的行为，最终会用vars的replace default的，所以结果是vars的<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis:&#10;   config:&#10;      port: 4567</span><br></pre></td></tr></table></figure></p>
<p>如果想得到merge的结果<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis:&#10;   config:&#10;      port: 4567&#10;      url: xxxx.redis.xxxx.com</span><br></pre></td></tr></table></figure><br>需要把配置改成<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># /etc/ansible/ansible.cfg&#10;hash_behaviour=merge</span><br></pre></td></tr></table></figure></p>
<h4 id="jinja2的if_else写法">jinja2的if else写法</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;/% if condition %/&#125;&#10;    do_some_thing&#10;&#123;/% elif condition2 /%&#125;&#10;    do_another_thing&#10;&#123;/% else /%&#125;&#10;    do_something_else&#10;&#123;/% endif /%&#125;</span><br></pre></td></tr></table></figure>
<p>看了书里的例子，这个写法可读性比较差，实在搞不定再考虑这种写法吧。</p>
<h4 id="用ansible-galaxy_生成role的基本骨架，这样就省得自己去建role需要的各种目录了">用ansible-galaxy 生成role的基本骨架，这样就省得自己去建role需要的各种目录了</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible-galaxy init --init-path roles/ dynamod</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">dadeMacBook-Pro:zoom_xmpp darcy$ ansible-galaxy init --init-path roles/ dynamodb</span><br><span class="line">- dynamodb was created successfully</span><br><span class="line"></span><br><span class="line">dadeMacBook-Pro:zoom_xmpp darcy$ <span class="built_in">cd</span> roles/dynamodb/</span><br><span class="line">dadeMacBook-Pro:dynamodb darcy$ ll -R</span><br><span class="line">total <span class="number">8</span></span><br><span class="line">-rw-r--r--  <span class="number">1</span> darcy  staff  <span class="number">1328</span> Sep  <span class="number">4</span> <span class="number">15</span>:<span class="number">44</span> README.md</span><br><span class="line">drwxr-xr-x  <span class="number">3</span> darcy  staff   <span class="number">102</span> Sep  <span class="number">4</span> <span class="number">15</span>:<span class="number">44</span> defaults</span><br><span class="line">drwxr-xr-x  <span class="number">2</span> darcy  staff    <span class="number">68</span> Sep  <span class="number">4</span> <span class="number">15</span>:<span class="number">44</span> files</span><br><span class="line">drwxr-xr-x  <span class="number">3</span> darcy  staff   <span class="number">102</span> Sep  <span class="number">4</span> <span class="number">15</span>:<span class="number">44</span> handlers</span><br><span class="line">drwxr-xr-x  <span class="number">3</span> darcy  staff   <span class="number">102</span> Sep  <span class="number">4</span> <span class="number">15</span>:<span class="number">44</span> meta</span><br><span class="line">drwxr-xr-x  <span class="number">3</span> darcy  staff   <span class="number">102</span> Sep  <span class="number">4</span> <span class="number">15</span>:<span class="number">44</span> tasks</span><br><span class="line">drwxr-xr-x  <span class="number">2</span> darcy  staff    <span class="number">68</span> Sep  <span class="number">4</span> <span class="number">15</span>:<span class="number">44</span> templates</span><br><span class="line">drwxr-xr-x  <span class="number">3</span> darcy  staff   <span class="number">102</span> Sep  <span class="number">4</span> <span class="number">15</span>:<span class="number">44</span> vars</span><br><span class="line"></span><br><span class="line">./defaults:</span><br><span class="line">total <span class="number">8</span></span><br><span class="line">-rw-r--r--  <span class="number">1</span> darcy  staff  <span class="number">33</span> Sep  <span class="number">4</span> <span class="number">15</span>:<span class="number">44</span> main.yml</span><br><span class="line"></span><br><span class="line">./files:</span><br><span class="line"></span><br><span class="line">./handlers:</span><br><span class="line">total <span class="number">8</span></span><br><span class="line">-rw-r--r--  <span class="number">1</span> darcy  staff  <span class="number">33</span> Sep  <span class="number">4</span> <span class="number">15</span>:<span class="number">44</span> main.yml</span><br><span class="line"></span><br><span class="line">./meta:</span><br><span class="line">total <span class="number">8</span></span><br><span class="line">-rw-r--r--  <span class="number">1</span> darcy  staff  <span class="number">2373</span> Sep  <span class="number">4</span> <span class="number">15</span>:<span class="number">44</span> main.yml</span><br><span class="line"></span><br><span class="line">./tasks:</span><br><span class="line">total <span class="number">8</span></span><br><span class="line">-rw-r--r--  <span class="number">1</span> darcy  staff  <span class="number">30</span> Sep  <span class="number">4</span> <span class="number">15</span>:<span class="number">44</span> main.yml</span><br><span class="line"></span><br><span class="line">./templates:</span><br><span class="line"></span><br><span class="line">./vars:</span><br><span class="line">total <span class="number">8</span></span><br><span class="line">-rw-r--r--  <span class="number">1</span> darcy  staff  <span class="number">29</span> Sep  <span class="number">4</span> <span class="number">15</span>:<span class="number">44</span> main.yml</span><br></pre></td></tr></table></figure>
]]></content>
    <summary type="html">
    <![CDATA[<h3 id="简介">简介</h3><p>个人觉得在阅读这本书前，最好读一些基础的ansible书籍，看过一些例子，然后自己写过一些ansible的playbook，对playbook有初步的了解，同时问题也有一些。<br>这本书是着重阐述怎么去设计一个结构良好，功能完善的pl]]>
    </summary>
    
      <category term="ansible" scheme="http://yoursite.com/tags/ansible/"/>
    
      <category term="reading-notes" scheme="http://yoursite.com/tags/reading-notes/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[扇贝上背完第一本单词书]]></title>
    <link href="http://yoursite.com/2015/07/15/title-shanbay-firstbook/index.html"/>
    <id>http://yoursite.com/2015/07/15/title-shanbay-firstbook/index.html</id>
    <published>2015-07-15T05:06:58.000Z</published>
    <updated>2015-07-15T05:33:15.000Z</updated>
    <content type="html"><![CDATA[<h5 id="背完第一本单词书">背完第一本单词书</h5><p>纪念一下，虽然很慢，花了284天，但是shanbay的强制体验和不断的循环让背过的单词还是比较牢固的。</p>
<h3 id="背完的第一本是雅思高频词">背完的第一本是雅思高频词</h3><p><img src="http://7xk2xu.com1.z0.glb.clouddn.com/Snip20150715_3.png" alt="first_word_book"></p>
<h3 id="扇贝账号概况">扇贝账号概况</h3><p><img src="http://7xk2xu.com1.z0.glb.clouddn.com/Snip20150715_6.png" alt="shanbay_profile"></p>
<h3 id="一共花了284天，今天的扇贝每日一句我也挺喜欢">一共花了284天，今天的扇贝每日一句我也挺喜欢</h3><p><img src="http://7xk2xu.com1.z0.glb.clouddn.com/Snip20150715_4.png" alt="284_days"></p>
<h5 id="我对扇贝的理解">我对扇贝的理解</h5><p>我觉得扇贝很多地方像早期的豆瓣，不温不火，低调踏实。<br>扇贝的英语学习产品没啥花哨的功能，有的只是实用。<br>然而最别具一格的就是强制性用户体验，比如：<br>任务不完成就不可以打卡。<br>任务差一点没完成也无法补救。<br>而打不了卡很多相关的任务也就失败了，比如连续多少天打卡的勋章之类的。<br>再比如，花了钱买了灵格斯字典，你会发现背单词就变成英翻译英了，就！没！中！文！了！！WTF！！！<br>花了钱反而不爽了，一点都不迎合用户体验，这简直没法玩了，扇贝的解释就是，如果你都选择英文字典了，那你还要看中文解释干什么呢？你必须要全英文的单词环境才可以啊。  </p>
<p>这点设定其实蛮有逼格的，假设说扇贝卖这字典，中文照显示，那么肯定会比现在买的人多。而扇贝似乎并不是优先考虑利润，按照这个逻辑，扇贝的意思大概是，你假如是个懒蛋，打卡完不成，又没决心脱离中文学英文，那你哪凉快哪呆着吧。<br>而真正努力好学的人呢？每天做任务基本钱又够花！！！WTF，扇贝看来压根就没想过赚勤奋努力好学生的钱。而懒蛋的钱又不惜的赚，这设定屌爆了！  </p>
<p>因为各种强制的设定，导致扇贝众也是各种强硬，比如你加入扇贝小组，你会惊奇的发现，一天忘了被单词你就会被剔除出小组，之前的积分也拜拜了。  </p>
<p>我不是自来水，花了近300天在这个平台上学习和体会他们的设计理念，让我不推荐也不行了，因为我确实很尊敬扇贝，在浮躁年代下一个很有逼格的学习网站。</p>
]]></content>
    <summary type="html">
    <![CDATA[<h5 id="背完第一本单词书">背完第一本单词书</h5><p>纪念一下，虽然很慢，花了284天，但是shanbay的强制体验和不断的循环让背过的单词还是比较牢固的。</p>
<h3 id="背完的第一本是雅思高频词">背完的第一本是雅思高频词</h3><p><img src]]>
    </summary>
    
      <category term="shanbay" scheme="http://yoursite.com/tags/shanbay/"/>
    
      <category term="english" scheme="http://yoursite.com/categories/english/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[vim养成计划]]></title>
    <link href="http://yoursite.com/2015/07/02/vim-tips/index.html"/>
    <id>http://yoursite.com/2015/07/02/vim-tips/index.html</id>
    <published>2015-07-02T12:54:08.000Z</published>
    <updated>2015-07-02T14:07:06.000Z</updated>
    <content type="html"><![CDATA[<blockquote>
<p>There will be many temptations in this new world. But as long as you remain brave, truthful and unselfish, you will not fail.</p>
<blockquote>
<p>新的世界里会有许多诱惑，只要你一直勇敢、诚实、无私，你就不会失败。</p>
</blockquote>
<p>——《童话镇》</p>
</blockquote>
<h4 id="开篇">开篇</h4><p>如果参加过各种编程比赛的同学，肯定对全键盘编程这个限定条件会有记忆。这个条件是不允许在编程时使用键盘以外的输入设备，比如触摸板和鼠标都是禁止的。<br>这个时候熟练vim的同学就会如鱼得水了，那大家肯定会反问，熟悉vim就是为了这个？当然不仅仅是！但是我们可以反过来想，比如code retreat这样影响比较广泛的编程活动，为什么会有这样的限定条件呢？肯定不是闲着蛋疼,那么就自己而言，我可以大概说说玩vim的好处。</p>
<blockquote>
<p>有兴趣的可以看看coderetreat关于no mouse的限定条件。<br><a href="http://coderetreat.org/facilitating/activity-catalog" target="_blank" rel="external">http://coderetreat.org/facilitating/activity-catalog</a></p>
</blockquote>
<ul>
<li>Geek精神，emacs和vim不熟练一个都说不过去。</li>
<li>本身自己是个Devops工程师，每天ssh在各种机器上干活，以前有一阵不用vim，但是用一个自我感觉良好的方法，所有的文本编辑在本地各种狂帅霸裤的现代编辑器上搞定，然后到远程机，vi -&gt;  9999999dd -&gt; Cmd +V -&gt; ZZ </li>
<li>效率高，虽然学习曲线陡峭，但是越熟练越快，有些地方是现代编辑器无法比拟的，比如现代编辑器都是通过鼠标定位，鼠标键盘来回切换来工作，而vi一方面会省略掉这个RTT，另一方面一眼就能定位的一些位置用5k，6j, 3w, fk之类的跳转快捷很多。</li>
</ul>
<h4 id="缘由">缘由</h4><p>完事皆有因，其实自己下决心用好vim还是因为一些触动，如前所述，2，3年以前，我很喜欢自己那套9999dd+ctrl v，那么运维的工作经常会share屏幕大家一起工作，我当时对自己这套做法还觉得不错。并且我并不是不会用，而是懒得用罢了。<br>有一日，和一个同事远程协作产品线上trouble shooting，看他用emacs无比娴熟，效率其高，真是无比羡慕，并且同时觉得自己很挫。<br>后来还下定决心也要把emaces练到他的程度，无奈试了一阵，觉得难度太大，放弃了，好在vi多少有些底子，起码正常编辑没问题，就专心把vim用好吧</p>
<h4 id="养成">养成</h4><p>如果让我推荐怎么练好vim，我觉得简单可以概括成一句话，随处都用vim。  </p>
<ul>
<li>比如我现在写这篇博客，虽然是在Idea编辑器里，但是用了vim的plugin，实际效果和vim没啥区别。  </li>
<li>我也是evernote用户，但是不在客户端里写note，有个替代方案叫geeknote，然后打开终端就可以用vi写evernote，有兴趣可以试试： <a href="http://www.geeknote.me/" target="_blank" rel="external">http://www.geeknote.me/</a></li>
<li>写邮件可以用Vmail或者mutt，<a href="https://linuxtoy.org/archives/vmail.html" target="_blank" rel="external">https://linuxtoy.org/archives/vmail.html</a></li>
<li>其他文件，如果需要云存储的，可以直接到网盘目录去vi</li>
</ul>
<h4 id="Tips">Tips</h4><ul>
<li>首先丢掉上下左右键，移动词别忘了用w, b</li>
<li>用Ctrl+c 替换Esc</li>
<li>复杂选文件用:Sex</li>
</ul>
<h4 id="资源">资源</h4><p>下面这个链接可真是够宅的。。。<br><a href="http://blog.jobbole.com/tag/vim/" target="_blank" rel="external">http://blog.jobbole.com/tag/vim/</a></p>
<p>vim的各种cheatsheet<br><a href="http://pan.baidu.com/s/1sjE5bjR" target="_blank" rel="external">http://pan.baidu.com/s/1sjE5bjR</a></p>
]]></content>
    <summary type="html">
    <![CDATA[<blockquote>
<p>There will be many temptations in this new world. But as long as you remain brave, truthful and unselfish, you will not fail]]>
    </summary>
    
      <category term="vim" scheme="http://yoursite.com/tags/vim/"/>
    
      <category term="linuxToys" scheme="http://yoursite.com/categories/linuxToys/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[first]]></title>
    <link href="http://yoursite.com/2015/07/01/first/index.html"/>
    <id>http://yoursite.com/2015/07/01/first/index.html</id>
    <published>2015-07-01T15:40:20.000Z</published>
    <updated>2015-07-01T15:40:20.000Z</updated>
    <content type="html"></content>
    <summary type="html">
    
    </summary>
    
  </entry>
  
</feed>